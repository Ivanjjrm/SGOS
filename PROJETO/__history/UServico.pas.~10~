unit UServico;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Buttons, Vcl.ExtCtrls,
  Vcl.Grids, Vcl.DBGrids, Uprincipal, Data.DB, IBX.IBCustomDataSet, IBX.IBQuery;

type
  TServico = class(TForm)
    Eservico: TEdit;
    Evalor: TEdit;
    Ebusca: TEdit;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    DBGrid1: TDBGrid;
    Panel1: TPanel;
    BitBtn4: TBitBtn;
    BitBtn1: TBitBtn;
    BitBtn2: TBitBtn;
    BitBtn3: TBitBtn;
    IBQuerycad: TIBQuery;
    IBQueryGrid: TIBQuery;
    DataSourcegrid: TDataSource;
    Eid: TEdit;
    IBQueryGridID_SERV: TIntegerField;
    IBQueryGridDESC_SERV: TIBStringField;
    IBQueryGridDATA_CAD: TDateField;
    IBQueryGridVALOR: TIBBCDField;
    procedure BitBtn3Click(Sender: TObject);
    procedure BitBtn4Click(Sender: TObject);
    procedure BitBtn1Click(Sender: TObject);
    procedure EbuscaKeyPress(Sender: TObject; var Key: Char);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Servico: TServico;

implementation

{$R *.dfm}

procedure TServico.BitBtn1Click(Sender: TObject);
begin
Eid.Clear;Eservico.Clear;Evalor.Clear;
end;

procedure TServico.BitBtn3Click(Sender: TObject);
begin
Close;
end;

procedure TServico.BitBtn4Click(Sender: TObject);
begin
Servico.Text:=Trim(Eservico.Text);
if (Eservico.text = '') then
begin
Servico.setfocus;
end;

 if (Eid.Text = '') and (Servico.Text <> '') then
  begin
   IBQueryCad.Close;
   IBQueryCAd.SQL.Text:='INSERT INTO SERVICO (ID_SERV,DESC_SERV,DATA_CAD,VALOR) '+
   ' VALUES (:id,:desc,:data,:valor)';
   IBQuerycad.ParamByName('id').Asinteger:=0;
   IBQuerycad.ParamByName('desc').AsString:=Eservico.Text;
   IBQuerycad.ParamByName('data').Asdate:=date;
   IBquerycad.ParamByName('valor').AsFloat:=strtofloat(Evalor.Text);
   IBQuerycad.ExecSQL;
   IBQueryGrid.active:= FALSE;
   IBQueryGrid.active:= true;
   Eid.Clear;Eservico.Clear;Evalor.Clear;
  end;

   if(Eid.Text <> '') and (Servico.Text <> '') then
    begin
     IBQueryCad.Close;
     IBQueryCad.SQL.Text:='UPDATE SERVICO SET DESC_SERV=:desc, DATA_CAD=:data, VALOR=:valor WHERE ID_SERV = :id';
     IBQuerycad.ParamByName('id').Asinteger:=Strtoint(Eid.Text);
     IBQuerycad.ParamByName('desc').AsString:=Eservico.Text;
     IBQuerycad.ParamByName('data').Asdate:=date;
     IBQuerycad.ParamByName('valor').AsFloat:=strtofloat(Evalor.Text);
     IBQuerycad.ExecSQL;
     IBQueryGrid.active:= FALSE;
     IBQueryGrid.active:= true;
     Eid.Clear;Eservico.Clear;Evalor.Clear;
    end;
end;

procedure TServico.EbuscaKeyPress(Sender: TObject; var Key: Char);
begin
IBQueryGrid.active := false;
IBQueryGrid.sql.clear;
IBQueryGrid.sql.add('SELECT * FROM SERVICO WHERE NOME_EQUIP LIKE :nome');
IBQueryGrid.ParamByName('nome').AsString := Ebusca.Text + '%';
IBQueryGrid.active:= true;
end;

end.
